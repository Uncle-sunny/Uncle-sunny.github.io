# 性能优化

前言：

软件开发我觉得首先比较重要的三个理念是

1. make it work
2. make it right
3. make it fast

快是最高层次的需求，快不是主要任务，而是次要任务，所以不要盲目追求速度，而是要注重代码的可读性和可维护性。因此，在进行性能优化时，应该优先考虑代码的可读性和可维护性，然后再考虑性能问题。

**还有一点非常重要的是，在尝试优化之前进行性能分析**

## 提纲

## 优化枚举结构占用空间

## 切片和向量的边界问题

vec的超出边界访问，这是一个老生常谈的问题，一些重大的安全事故也是因为超出索引边界导致

正常情况下在rust中对切片和向量等容器类型的访问是会触发边界检查的，这些检查在一定程度上会影响性能

一般常用的消除边界检查的方法有如下几种

1. 使用迭代替代循环中的直接元素访问
2. 尽量避免直接对 `Vec` 进行索引， 而是通过在循环之前创建一个 `Vec` 的切片， 对切片进行索引
3. 使用 `unsafe` 块来消除边界检查，但需要非常小心，因为这可能会导致未定义的行为
4. 为索引变量的范围添加断言

## 代码构建改善
